<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PYTHAVA | Admin Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #d1d5db; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .border-main { border-color: #1f2937; }
        .sidebar-item { transition: all 0.2s; border-left: 2px solid transparent; }
        .sidebar-item.active { border-left: 2px solid #3b82f6; background-color: #0f172a; color: white; }
        .admin-table th { font-family: 'JetBrains Mono'; font-size: 11px; text-transform: uppercase; color: #64748b; padding: 12px; text-align: left; border-bottom: 1px solid #1f2937; }
        .admin-table td { padding: 12px; border-bottom: 1px solid #111827; font-size: 13px; }
        .input-field { background-color: #0a0a0a; border: 1px solid #1f2937; color: white; padding: 12px; border-radius: 6px; outline: none; transition: border 0.2s; }
        .input-field:focus { border-color: #3b82f6; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="border-b border-main sticky top-0 bg-[#0a0a0a]/90 backdrop-blur-md z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex-1"><a href="/" class="text-white font-extrabold text-xl">PYTHAVA <span class="text-red-500 text-xs ml-2 mono">ADMIN</span></a></div>
            <div class="flex-1 flex justify-end">
                <button onclick="handleLogout()" class="text-[10px] mono text-gray-600 hover:text-white">TERMINATE_SESSION</button>
            </div>
        </div>
    </nav>

    <div class="flex flex-1 max-w-7xl mx-auto w-full">
        <aside class="w-64 border-r border-main p-6">
            <nav class="space-y-2">
                <button onclick="showSection('user')" id="menu-user" class="sidebar-item active w-full text-left px-4 py-3 text-sm font-bold flex items-center gap-3">USR_MGMT</button>
                <button onclick="showSection('blog')" id="menu-blog" class="sidebar-item w-full text-left px-4 py-3 text-sm font-bold flex items-center gap-3 text-gray-500 hover:text-white">BLOG_MGMT</button>
                <button onclick="showSection('wargame')" id="menu-wargame" class="sidebar-item w-full text-left px-4 py-3 text-sm font-bold flex items-center gap-3 text-gray-500 hover:text-white">WAR_MGMT</button>
            </nav>
        </aside>

        <main class="flex-1 p-8">
            
            <section id="section-user">
                <h2 class="text-xl font-bold text-white mb-6 mono">/Users</h2>
                <div class="border border-main rounded-lg overflow-hidden">
                    <table class="w-full admin-table bg-[#0a0a0a]">
                        <thead><tr><th>Email</th><th>Created At</th><th>Status</th><th>Action</th></tr></thead>
                        <tbody id="user-list"></tbody>
                    </table>
                </div>
            </section>

            <section id="section-blog" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-white mono">/Blog</h2>
                    <button class="bg-white text-black px-4 py-2 rounded text-xs font-bold hover:bg-blue-500 hover:text-white">NEW_POST</button>
                </div>
                <div id="blog-list" class="space-y-3"></div>
            </section>

            <section id="section-wargame" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="border border-main p-6 rounded bg-[#0a0a0a]">
                        <h3 class="text-xs font-bold text-blue-500 mb-4 mono uppercase">Deploy Challenge</h3>
                        <form id="wargame-form" class="flex flex-col gap-4">
                            <input type="text" id="wg-title" placeholder="Challenge Title" class="input-field" required>
                            <input type="text" id="wg-tags" placeholder="Tags (e.g. #web #pwn #crypto)" class="input-field">
                            <select id="wg-difficulty" class="input-field">
                                <option value="1">Level 1 - Easy</option>
                                <option value="2">Level 2 - Normal</option>
                                <option value="3">Level 3 - Medium</option>
                                <option value="4">Level 4 - Hard</option>
                                <option value="5">Level 5 - Insane</option>
                            </select>
                            <textarea id="wg-desc" placeholder="Description" rows="4" class="input-field" required></textarea>
                            <div class="flex gap-4">
                                <input type="text" id="wg-flag" placeholder="PT{FL4G_H3RE}" class="input-field flex-1" required>
                                <input type="number" id="wg-points" placeholder="Points" class="input-field w-24" required>
                            </div>
                            <button type="submit" class="bg-blue-600 text-white py-4 rounded font-bold text-xs uppercase hover:bg-blue-500 transition-all">Publish Challenge</button>
                        </form>
                    </div>

                    <div>
                        <h3 class="text-xs font-bold text-gray-500 mb-4 mono uppercase">Active List</h3>
                        <div id="wargame-list" class="space-y-2 max-h-[600px] overflow-y-auto"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Supabase 초기화
        const SB_URL = "https://udcsxjtnnrxolwmavyqo.supabase.co";
        const SB_KEY = "sb_publishable_q_NjT8knSzwiL7TOOajWYg_5FN1zIZp";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        // 섹션 전환
        function showSection(name) {
            ['user', 'blog', 'wargame'].forEach(s => {
                document.getElementById('section-' + s).classList.add('hidden');
                document.getElementById('menu-' + s).classList.remove('active', 'text-white');
            });
            document.getElementById('section-' + name).classList.remove('hidden');
            document.getElementById('menu-' + name).classList.add('active', 'text-white');
            
            if(name === 'wargame') fetchWargames();
            if(name === 'blog') fetchBlogs();
        }

        // 워게임 추가 로직
        document.getElementById('wargame-form').onsubmit = async (e) => {
            e.preventDefault();
            const { data, error } = await _supabase.from('challenges').insert([{
                title: document.getElementById('wg-title').value,
                tags: document.getElementById('wg-tags').value,
                difficulty: document.getElementById('wg-difficulty').value,
                description: document.getElementById('wg-desc').value,
                flag: document.getElementById('wg-flag').value,
                points: document.getElementById('wg-points').value
            }]);

            if (error) alert("Error: " + error.message);
            else {
                alert("Challenge Deployed!");
                document.getElementById('wargame-form').reset();
                fetchWargames();
            }
        };

        // 워게임 리스트 불러오기
        async function fetchWargames() {
            const { data, error } = await _supabase.from('challenges').select('*').order('id', { ascending: false });
            const listArea = document.getElementById('wargame-list');
            listArea.innerHTML = data.map(wg => `
                <div class="border border-main p-4 rounded bg-[#0a0a0a]/50 flex justify-between items-center group">
                    <div>
                        <p class="text-[10px] mono text-blue-500">LV.${wg.difficulty} | ${wg.tags}</p>
                        <p class="text-sm font-bold text-white">${wg.title}</p>
                    </div>
                    <button onclick="deleteWg(${wg.id})" class="text-gray-600 hover:text-red-500">×</button>
                </div>
            `).join('');
        }

        async function deleteWg(id) {
            if(confirm('Delete this challenge?')) {
                await _supabase.from('challenges').delete().eq('id', id);
                fetchWargames();
            }
        }

        // 블로그/유저 등 추가 기능은 테이블 설정에 따라 이와 유사하게 확장 가능합니다.
        function handleLogout() {
            _supabase.auth.signOut().then(() => location.href = '/login');
        }
    </script>
</body>
</html>
